<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>DSP_FilterLMS16 Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', '00454.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00651.html" target="topic">Math Libraries Help</a> &gt; <a href="00638.html" target="topic">DSP</a> &gt; <a href="00648.html" target="topic">Library Interface</a> &gt; Functions &gt; <a href="00454.html" target="topic">DSP_FilterLMS16 Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00158.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00453.html" target="topic">Previous</a> | <a href="00648.html" target="topic">Up</a> | <a href="00455.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DSP_FilterLMS16@int16_t@int16_t@int16_t *@int16_t *@int16_t *@int@int16_t Topic Title: DSP_FilterLMS16 Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table><div class="Element5">
DSP_FilterLMS16 Function</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="53756D6D617279"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
Performs a single sample Least Mean Squares FIR Filter.</p></div>
</div>
<a name="4465736372697074696F6E"></a><div class="Element14">
Description</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
Function DSP_FilterLMS16:&nbsp;</p>
<p class="Element10">
int16_t DSP_FilterLMS16(int16_t in, int16_t ref, int16_t *coeffs, int16_t *delayline, int16_t *error, int K, int16_t mu);&nbsp;</p>
<p class="Element10">
Computes an LMS adaptive filter on the input in. Filter output of the FIR is given as a 16 bit value. The filter target is ref, and the calculation difference between the output and the target is error. The filter adapts its coefficients, coefs, on each pass. The number of coefficients (filter taps) is given by the value K. The delayline array should be initialized to zero prior to calling the filter for the first time, and have K elements. The value mu is the rate at which the filter adapts. All values are Q15 fractional numbers. The function will saturate the output if it exceeds maximum or minimum values. The LMS will adapt its coefs to attempt to drive the output value toward the ref value. The rate of adaption on each pass depends on mu and the error from the previous calculation.</p></div>
</div>
<a name="507265636F6E646974696F6E73"></a><div class="Element14">
Preconditions</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The pointers outdata and indata must be aligned on 4-byte boundaries. delayline must have (K) elements, and be initialized to zero. K (taps) must be a multiple of 4, and &gt;= 8. mu must be positive.</p></div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
Parameters</div>
<div class="Element11">
<div class="Element10">
<div class="Element312">
<div class="TableDiv">
<table cellspacing="0" class="Table3">
<tr>
<td class="Element300" valign="top" width="35%">
<div class="Element301">
Parameters&nbsp;</div></td><td class="Element304" valign="top" width="65%">
<div class="Element305">
Description&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
in&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
input data value (int16_t)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
ref&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
target output value (int16_t)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
coeffs&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
pointer to an array of coefficients (int16_t)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
delayline&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
pointer to an array of delay variables (int16_t)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
error&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
output minus reference (int16_t)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
K&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
number of filter taps and coeffs (int)&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
mu&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
adaption rate (int16_t)&nbsp;</div></td></tr></table></div></div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
Returns</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
(int16_t) - FIR filter output</p></div>
</div>
<a name="4578616D706C65"></a><div class="Element14">
Example</div>
<div class="Element11">
<div class="Element10">
<div class="Element13"><div class="Element12"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> lmsTAPS 8

int16_t lmsOut;
<strong><span style="color: #000080">int</span></strong> lmsTaps = lmsTAPS;

int16_t lmsCoefs[lmsTAPS]={0x5000, 0x4000,0x3000, 0x2000,0x1000, 0x0000,0xF000, 0xE000};
int16_t lmsDelay[lmsTAPS]={0};
int16_t *ptrLMSError;
int16_t lmsError = 0x0200;
int16_t inVal=0;

int16_t refVal = 0x0CCC;  <i><span style="color: #008000">// some target value = 0.1</span></i>
int16_t lmsAdapt = 0x3000;

ptrLMSError = &amp;lmsError;

<strong><span style="color: #000080">for</span></strong> (i=0;i&lt;200;i++)
{
<i><span style="color: #008000">// get some input value here //</span></i>
 <strong><span style="color: #000080">if</span></strong> (i &lt; 100)
 {
     inVal = 0x4233;
 }
 <strong><span style="color: #000080">else</span></strong>
 {
     inVal = 0xCF10;
 }

 lmsOut =  DSP_FilterLMS16(inVal, refVal, lmsCoefs, lmsDelay,
       ptrLMSError, lmsTaps, lmsAdapt);
}</pre></div></div>
</div>
</div>
<a name="52656D61726B73"></a><div class="Element14">
Remarks</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
Filter coefs may start at random or zero value, but convergence is dependent on the amount of update required.</p></div>
</div>
<a name="43"></a><div class="Element99">
C</div>
<div class="Element101"><div class="Element100"><pre class="Element100">int16_t <strong><span style="color: #000000">DSP_FilterLMS16</span></strong>(
    int16_t <strong><span style="color: #000000">in</span></strong>, 
    int16_t <strong><span style="color: #000000">ref</span></strong>, 
    int16_t * <strong><span style="color: #000000">coeffs</span></strong>, 
    int16_t * <strong><span style="color: #000000">delayline</span></strong>, 
    int16_t * <strong><span style="color: #000000">error</span></strong>, 
    <strong><span style="color: #000080">int</span></strong> <strong><span style="color: #000000">K</span></strong>, 
    int16_t <strong><span style="color: #000000">mu</span></strong>
);</pre></div></div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00651.html" target="topic">Math Libraries Help</a> &gt; <a href="00638.html" target="topic">DSP</a> &gt; <a href="00648.html" target="topic">Library Interface</a> &gt; Functions &gt; <a href="00454.html" target="topic">DSP_FilterLMS16 Function</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element3">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00158.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element91">
<a href="00453.html" target="topic">Previous</a> | <a href="00648.html" target="topic">Up</a> | <a href="00455.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DSP_FilterLMS16@int16_t@int16_t@int16_t *@int16_t *@int16_t *@int@int16_t Topic Title: DSP_FilterLMS16 Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>