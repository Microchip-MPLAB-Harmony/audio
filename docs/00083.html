<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>usb_microphone</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', '00083.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00096.html" target="topic">Audio Demonstrations</a> &gt; <a href="00081.html" target="topic">Demonstrations</a> &gt; <a href="00083.html" target="topic">usb_microphone</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00102.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00064.html" target="topic">Previous</a> | <a href="00081.html" target="topic">Up</a> | <a href="00084.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usb_microphone Topic Title: usb_microphone)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table><div class="Element5">
usb_microphone</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
This demonstration application configures the development board to implement a USB Microphone device configured to run at 16 Khz sampling rate at 16 bit per sample.&nbsp;</p>
<p class="Element10">
The USB Device driver in Full Speed mode will interface to a USB Host (such as a personal computer) via the USB Device Stack using the V1.0 Audio Function Driver. The embedded system will enumerate with a USB audio device endpoint and enable the host system to input audio from the USB port using a standard USB Full-Speed implementation. The embedded system will stream USB playback audio to the Codec. The Codec Driver sets up the audio interface, timing, DMA channels and buffer queue to enable a continuous audio stream. The digital audio is transmitted to the codec through an I2S data module for playback through a headphone jack.&nbsp;</p>
<p class="Element10">
&nbsp;</p><div class="Element15">
Architecture</div>
<p class="Element10">
The application runs on the SAM E70 Xplained Ultra Board (E70XULT), which contains can operate at 300 MHz using the following features:</p>
<ul class="Element630">
<li class="Element600">One push button (SW1)</li>
<li class="Element600">Two LEDs (amber LED1 and green LED2). Only LED 1 can be used for a USB Device, that requires VBUS sense.</li>
<li class="Element600">WM8904 Codec Daughter Board mounted on a X32 socket</li>
<li class="Element600">USB Device interface</li>
</ul><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
The SAM E70 Xplained Ultra board does not include the WM8904 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part number AC328904.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
The usb_microphone application uses the MPLAB Harmony Configurator to setup the USB Audio Device, codec, and other items in order to play back the USB audio through the WM8904 Codec Module.&nbsp;</p>
<p class="Element10">
A USB device is connected to the micro-mini USB device connector. The application detects the cable connection, which can also supply device power; recognizes the type of connection (Full Speed); enumerates its functions with the host, isochronous audio streaming playback or recording through the device. Audio stream data is buffered in 1 ms frames for playback or recording using the WM8904 Codec daughter board. Audio is can be heard through the Headphone jack (HP OUT).&nbsp;</p>
<p class="Element10">
The following figure shows the basic architecture for the demonstration. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 Architecture Diagram.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone Application Block Diagram</i>&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p><div class="Element15">
Demonstration Features</div>

<ul class="Element630">
<li class="Element600">Audio recording using an WM8904 codec daughterboard on the SAM E70 Xplained Ultra (E70XULT) board.</li>
<li class="Element600">USB device connection to a host system using the USB Library Device Stack for a USB Microphone device implemented on the SAM E70XULTZ</li>
<li class="Element600">E70 XULT Button processing for microphone gain control</li>
<li class="Element600">Using the USB Library</li>
<li class="Element600">USB Attach/Detach and mute status using an LED.</li>
<li class="Element600">Looping back of the microphone data to the codec headphone output for for playback monitoring of the input audio.</li>
</ul><p class="Element10">
&nbsp;</p>
<p class="Element10">
<strong>Harmony Configuration and Code Generation</strong>&nbsp;</p>
<p class="Element10">
The MPLAB-X Harmony Configurator (MHC) Project Graph for usb_microphone_basic is shown below. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 project graph.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone Application MPLAB-X Harmony Configurator Project Graph</i>&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p><p class="Element10">
Each block provides configuration parameters to generate the application framework code. This includes all the needed drivers, middleware, libraries. The generated framework code is placed under the firmware/src/config directory under the Harmony 3 project configuration. This Harmony 3 application has two configurations, as described below :</p>
<ol class="Element630">
<li value="1" class="Element600">usb_microphone_basic_sam_e70_xult_wm8904_i2sc1_usb - A bare-metal configuration</li>
<li value="2" class="Element600">usb_microphone_basic_sam_e70_xult_wm8904_i2sc1_usb_freertos&gt; - A configuration that uses the 3rd party FreeRTOS operating system.</li>
</ol><p class="Element10">
The harmony application system components, drivers and mideleware is configured based on the project graph.&nbsp;</p>
<p class="Element10">
In many cases the default configuration values are used, but in general each application requires modifications to these parameter.&nbsp;</p>
<p class="Element10">
The usb_microphone_basic custom application code code is located in the firmware/src directory of the application folder. The app.c and app.h files are initially generated as stub files in this folder. The middleware and library APIs located in definitions.h (as generated by MHC), for the given project graph.&nbsp;</p>
<p class="Element10">
The usb_microphone application utilizes a state machine with the following functions:</p>
<ol class="Element630">
<li value="1" class="Element600">Setup the drivers and USB Library interface as used by the application</li>
</ol><p class="Element10">
a. WM8904 Codec Driver&nbsp;</p>
<p class="Element10">
b. Timer&nbsp;</p>
<p class="Element10">
c. USB Audio</p>
<ol class="Element630">
<li value="2" class="Element600">Respond to USB Host control commands (“Attach”, “Detach”, “Suspend”, etc.)</li>
<li value="3" class="Element600">Initiate and maintains the audio data streaming for the &quot;USB Record&quot; function as data is received from the microphone codec.</li>
</ol><p class="Element10">
All Harmony applications use the function SYS_Initialize function located in the MHC generated file initialization.c. This is executed from main to initialize various subsystems such as the clock, ports, BSP (board support package), codec, usb, timers, and interrupts. The application APP_Initialize function in app.c is also executed at the end of this routine to setup the application code state machine.&nbsp;</p>
<p class="Element10">
For the bare-metal configuration The USB, WM8904 driver, and the application code state machines(APP_Tasks routine in app.c) are all updated via calls located in the function SYS_Tasks, executed from the main polling loop, located in the MHC generated tasks.c.&nbsp;</p>
<p class="Element10">
For the FreeRTOS configuration 4 tasks are configured within 3 processes of a round-robin scheduler. The APP_Tasks and Codec update tasks is in 1 of the scheduled process, while the USB High Speed Driver and USB Device Driver are in there own separate tasks.&nbsp;</p>
<p class="Element10">
&nbsp;</p><div class="Element15">
Tools Setup Differences</div>
<p class="Element10">
<i>USB Configuration</i>&nbsp;</p>
<p class="Element10">
The application uses USB Library as a &quot;Device&quot; stack, which will connect to a &quot;Host&quot;. The USB High Speed Driver is selected to by “Full Speed” (not “High Speed”): </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone usb high speed.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB High Speed Driver Configuration</i>&nbsp;</p><p class="Element10">
The USB Device Layer is configured by selecting the “usb_microphone_demo” with an endpoint buffer size of 64 (bytes). The Audio Function Driver is configured for 5 USB endpoints with a single function having 3 interfaces. All of these are defined for a USB Microphone device in the fullSpeedConfigurationDescriptor array variable structure (located in initialization.c under the config folder). This structure defines the connection to the host at 48 Khz with 16 bit stereo channel data. A packet queue of length APP_QUEUE_SIZE (set to 2) is used for playback data. The maximum USB packets size is set to 16 samples * 2 channels per sample * 2 bytes per channel= 64 bytes, which gives a 1ms stereo sample packet size at 16Khz (the standard data frame length at this rate), thus the buffer size needs to be of the same size. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone usb device layer.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Device Layer Configuration</i></p><p class="Element10">
The Audio Function Driver is configured with a Audio Read Queue that matches that of the codec driver write queue for this Audio V1.0 USB Microphone interface. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone usb audio function.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Audio Function Configuration</i>&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<p class="Element10">
<i>The WM8904 Codec Configuration</i>&nbsp;</p>
<p class="Element10">
The WM8904 codec uses a TWIHS0 (I2C) interface for module configuration and control register setting and a I2SC1 (I2S) interface for audio data. The default settings are used.&nbsp;</p>
<p class="Element10">
The default values are used for the TWIHS and I2C drivers.&nbsp;</p>
<p class="Element10">
The E70 I2SC1 driver is set to be the master with a data length of 16, 2 channels (stereo) and a MCLK divider value of of 256. These a default values, as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone i2sc1.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>I2SC1 Peripheral Configuration</i>&nbsp;</p><p class="Element10">
The I2S driver is configured with transfer queue size of 8 (default value) that matches that of the USB Read Queue, as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone i2s.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone I2S Configuration</i></p><p class="Element10">
The WM8904 Codec is configured with an I2S slave interface operating at 16000 Hz sampling rate, as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone wm8904.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone I2S Configuration</i></p><p class="Element10">
Also, the microphone input is enabled with bias for an electret microphone.&nbsp;</p>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
<i>Pin Manager Configuration</i>&nbsp;</p>
<p class="Element10">
The buttons, LED, Switch, I2S and I2C interfaces using GPIO pins via the Microchip Harmony Configurator (MHC) Pin Manager, as follows:&nbsp;</p>
<p class="Element10">
When the I2SC1 is used the following pins are used: </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="26%">
<div class="Element66">
NAME&nbsp;</div></td><td class="Element65" valign="top" width="11%">
<div class="Element66">
PORT&nbsp;</div></td><td class="Element65" valign="top" width="6%">
<div class="Element66">
E70 PIN&nbsp;</div></td><td class="Element65" valign="top" width="57%">
<div class="Element66">
Notes&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
I2SC1_WS&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PE00&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
4&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S LRCK (Word Select)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
I2SC1_DO0&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PE01&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
6&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S DO (Data Out)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
I2SC1_DI0&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PE02&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
7&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S DI (Data In)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
I2SC1_CK&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA20&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
22&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S BCLK (Bit Clock)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
I2SC1_GCLK&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA19&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
23&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S MCLK (Bit Clock as used by the E70 I2SC1, I2S Master)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
PMC_PCK2&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA18&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
24&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2S MCLK (Master Clock as used by the WM8904 Codec I2S Slave)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
SWITCH&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA11&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
66&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
Push Button&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
LED1&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA05&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
73&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
TWIHS0_TWCK0&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA04&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
77&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2C&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
TWIHS0_TWD0&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PA03&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
91&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
I2C&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
STDBY&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PD11&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
98&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="26%">
<div class="Element68">
LED2/VBUS DETECT(J204)&nbsp;</div></td><td class="Element67" valign="top" width="11%">
<div class="Element68">
PB08&nbsp;</div></td><td class="Element67" valign="top" width="6%">
<div class="Element68">
141&nbsp;</div></td><td class="Element67" valign="top" width="57%">
<div class="Element68">
J204 set to VBUS DETECT for USB Device&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
<i>Clock Manager</i>&nbsp;</p>
<p class="Element10">
All clocks are generated from the 12 Mhz Main Clock oscillator, including the following. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="19%">
<div class="Element66">
Clock&nbsp;</div></td><td class="Element65" valign="top" width="23%">
<div class="Element66">
Value&nbsp;</div></td><td class="Element65" valign="top" width="58%">
<div class="Element66">
Description&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
HCLK&nbsp;</div></td><td class="Element67" valign="top" width="23%">
<div class="Element68">
240 MHz&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Processor Clock&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
USB FS&nbsp;</div></td><td class="Element67" valign="top" width="23%">
<div class="Element68">
48 MHz&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
USB Full Speed Clock&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
The I2SC1 peripheral is set as the I2S bus master. It uses the I2SC1_GCLK to generate the I2S timing to the codec slave I2S interface.&nbsp;</p>
<p class="Element10">
The I2SC clocks are setup for 16Khz sampling rate (LRCK), with stereo 16 bit samples, giving a 32 bit sample frame. The frame bit clock (BCLK) and the I2S Master clock (MCLK) is calculated as follows: </p><p class="Element10" style="text-align: center;">
<sup>LRCK = 16 KHz FRAME_SIZE = 16 bits/channel * 2 channels BCLK = LRCK * 16 * 2 = .512 KHz MCLK_MULT = 256 MCLK = MCLK_MULT * LRCK = 4.096 KHz</sup></p><p class="Element10">
The generated MCLK should be set as close as possible to the calculated values as given below: </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="47%">
<div class="Element66">
CLOCK&nbsp;</div></td><td class="Element65" valign="top" width="53%">
<div class="Element66">
I2S Function&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="47%">
<div class="Element68">
I2SC1_WS&nbsp;</div></td><td class="Element67" valign="top" width="53%">
<div class="Element68">
LRCK&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="47%">
<div class="Element68">
I2SC1_CK&nbsp;</div></td><td class="Element67" valign="top" width="53%">
<div class="Element68">
BCLK&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="47%">
<div class="Element68">
I2SC1_GCLK&nbsp;</div></td><td class="Element67" valign="top" width="53%">
<div class="Element68">
MCLK(I2SC1)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="47%">
<div class="Element68">
PCK2&nbsp;</div></td><td class="Element67" valign="top" width="53%">
<div class="Element68">
MCLK(X32)&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
The E70 XULT board only provides PCK2 as the source of the MCLK to the X32 WM8904 Codec Daughter Board connector. It must be generated the same as I2SC1_GCLK.&nbsp;</p>
<p class="Element10">
The actual generated value utilizes the PLLA clock as the source for both the I2SC1_GCLK and the PCK2. These values generate the following clocks These I2S clocks are generated from the I2SC1 GCLK peripheral acting as I2S master.&nbsp;</p>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
<i>MPLAB Harmony Configurator: Clock Diagram Configuration</i>&nbsp;</p>
<p class="Element10">
The MHC Clock Diagram to generate the processor (HCK), PCK2 (I2S MCLK), and the I2SC1 MCLK (I2SC1_GCLK) is given below. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 clock1.png" border="0" alt="" title=""></p><p class="Element10">
&nbsp;</p>
<p class="Element10">
<i>USB Microphone MHC Clock Diagram</i>&nbsp;</p>
<p class="Element10">
Uncheck the Main RC Oscillator and check the “Bypass” for the Main Crystal Oscillator. When the Bypass is checked, it will cause the Main Crystal Oscillator to become disabled. An external MEMS oscillator input on the XIN pin is used for Main Clock generation. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 clock2.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone Main Clock</i>&nbsp;</p><p class="Element10">
The PLLA clock is generated from 12 Mhz Main Clock using the selected DIVA and MULA values, as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 clock3.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone PLLA Clock</i></p><p class="Element10">
The I2S MCLK is generated using both the PCK2 output and the I2SC1_GCLK. These are both enabled and generated using the PLLA clock source to give the same value of 4,095,238 Hz (to approximate the 4096000 Hz sampling rate), as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_microphone E70 clock4.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<i>USB Microphone I2S1 GCLK and PCK2 Configuration</i></p><p class="Element10">
<i>Timer Driver</i>&nbsp;</p>
<p class="Element10">
The Timer driver configuration, Timer driver instance 0, is used by a system for button processing (debounce and long press) and LED blink delay. It needs to be set to “Enable Period Interrupt”. It is also required by the WM8904 Codec Driver. The default configuration values are used.</p></div>
</div>
<a name="546F70696373"></a><div class="Element14">
Topics</div>
<div class="Element11">
<div class="Element10">
<div class="Element212">
<div class="TableDiv">
<table cellspacing="0" class="Table1">
<tr>
<td class="Element200" valign="top" width="35%">
<div class="Element201">
Name&nbsp;</div></td><td class="Element204" valign="top" width="65%">
<div class="Element205">
Description&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00084.html" target="topic">Building the Application</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section identifies the MPLAB X IDE project name and location and lists and describes the available configurations for the demonstration.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00085.html" target="topic">Configuring the Hardware</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section describes how to configure the supported hardware.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00086.html" target="topic">Running the Demonstration</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section demonstrates how to run the demonstration.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00096.html" target="topic">Audio Demonstrations</a> &gt; <a href="00081.html" target="topic">Demonstrations</a> &gt; <a href="00083.html" target="topic">usb_microphone</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element3">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00102.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element91">
<a href="00064.html" target="topic">Previous</a> | <a href="00081.html" target="topic">Up</a> | <a href="00084.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usb_microphone Topic Title: usb_microphone)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>