<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>DRV_WM8904_BufferAddWriteRead Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', '00233.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00090.html" target="topic">Audio Driver Libraries Help</a> &gt; <a href="00355.html" target="topic">WM8904 CODEC Driver Library Help</a> &gt; <a href="00356.html" target="topic">Library Interface</a> &gt; Data Transfer Functions &gt; <a href="00233.html" target="topic">DRV_WM8904_BufferAddWriteRead Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00096.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00232.html" target="topic">Previous</a> | <a href="00356.html" target="topic">Up</a> | <a href="00275.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_WM8904_BufferAddWriteRead@DRV_HANDLE@DRV_WM8904_BUFFER_HANDLE *@void *@void *@size_t Topic Title: DRV_WM8904_BufferAddWriteRead Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table><div class="Element5">
DRV_WM8904_BufferAddWriteRead Function</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="46756E6374696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
   void DRV_WM8904_BufferAddWriteRead&nbsp;</p>
<p class="Element10">
       (&nbsp;</p>
<p class="Element10">
               const DRV_HANDLE handle,&nbsp;</p>
<p class="Element10">
               <a href="00229.html" target="topic">DRV_WM8904_BUFFER_HANDLE</a> *bufferHandle,&nbsp;</p>
<p class="Element10">
               void *transmitBuffer, &nbsp;</p>
<p class="Element10">
               void *receiveBuffer,&nbsp;</p>
<p class="Element10">
               size_t size&nbsp;</p>
<p class="Element10">
       )&nbsp;</p>
<p class="Element10">
&nbsp;</p></div>
</div>
<a name="53756D6D617279"></a><div class="Element14">
<a onclick="toggleVisibilityStored('53756D6D617279');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img53756D6D617279">Summary</a></div>
<div id="div53756D6D617279">
<div class="Element11">
<div class="Element10">
<p class="Element10">
Schedule a non-blocking driver write-read operation.</p></div>
</div>
</div>
<a name="4465736372697074696F6E"></a><div class="Element14">
Description</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
This function schedules a non-blocking write-read operation. The function returns with a valid buffer handle in the bufferHandle argument if the write-read request was scheduled successfully. The function adds the request to the hardware instance queue and returns immediately. While the request is in the queue, the application buffer is owned by the driver and should not be modified. The function returns DRV_WM8904_BUFFER_EVENT_COMPLETE:</p>
<ul class="Element630">
<li class="Element600">if a buffer could not be allocated to the request</li>
<li class="Element600">if the input buffer pointer is NULL</li>
<li class="Element600">if the client opened the driver for read only or write only</li>
<li class="Element600">if the buffer size is 0</li>
<li class="Element600">if the queue is full or the queue depth is insufficient</li>
</ul><p class="Element10">
If the requesting client registered an event callback with the driver, the driver will issue a DRV_WM8904_BUFFER_EVENT_COMPLETE event if the buffer was processed successfully of DRV_WM8904_BUFFER_EVENT_ERROR event if the buffer was not processed successfully.</p></div>
</div>
<a name="507265636F6E646974696F6E73"></a><div class="Element14">
Preconditions</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The <a href="00264.html" target="topic">DRV_WM8904_Initialize</a> routine must have been called for the specified WM8904 device instance and the <a href="00278.html" target="topic">DRV_WM8904_Status</a> must have returned SYS_STATUS_READY.&nbsp;</p>
<p class="Element10">
<a href="00274.html" target="topic">DRV_WM8904_Open</a> must have been called to obtain a valid opened device handle.&nbsp;</p>
<p class="Element10">
DRV_IO_INTENT_READWRITE must have been specified in the <a href="00274.html" target="topic">DRV_WM8904_Open</a> call.</p></div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
Parameters</div>
<div class="Element11">
<div class="Element10">
<div class="Element312">
<div class="TableDiv">
<table cellspacing="0" class="Table3">
<tr>
<td class="Element300" valign="top" width="35%">
<div class="Element301">
Parameters&nbsp;</div></td><td class="Element304" valign="top" width="65%">
<div class="Element305">
Description&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
handle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Handle of the WM8904 instance as returned by the <a href="00274.html" target="topic">DRV_WM8904_Open</a> function&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
bufferHandle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Pointer to an argument that will contain the return buffer handle&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
transmitBuffer&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
The buffer where the transmit data will be stored&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
receiveBuffer&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
The buffer where the received data will be stored&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
size&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Buffer size in bytes&nbsp;</div></td></tr></table></div></div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
Returns</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The bufferHandle parameter will contain the return buffer handle. This will be <a href="00230.html" target="topic">DRV_WM8904_BUFFER_HANDLE_INVALID</a> if the function was not successful.</p></div>
</div>
<a name="4578616D706C65"></a><div class="Element14">
Example</div>
<div class="Element11">
<div class="Element10">
<div class="Element13"><div class="Element12"><pre class="Element12">
MY_APP_OBJ myAppObj;
uint8_t mybufferTx[MY_BUFFER_SIZE];
uint8_t mybufferRx[MY_BUFFER_SIZE];
<a href="00229.html" target="topic">DRV_WM8904_BUFFER_HANDLE</a> bufferHandle;

<i><span style="color: #008000">// mywm8904Handle is the handle returned</span></i>
<i><span style="color: #008000">// by the DRV_WM8904_Open function.</span></i>

<i><span style="color: #008000">// Client registers an event handler with driver</span></i>

<a href="00234.html" target="topic">DRV_WM8904_BufferEventHandlerSet</a>(mywm8904Handle,
                APP_WM8904BufferEventHandler, (uintptr_t)&amp;myAppObj);

DRV_WM8904_BufferAddWriteRead(mywm8904handle, &amp;bufferHandle,
                                    mybufferTx,mybufferRx,MY_BUFFER_SIZE);

<strong><span style="color: #000080">if</span></strong>(<a href="00230.html" target="topic">DRV_WM8904_BUFFER_HANDLE_INVALID</a> == bufferHandle)
{
    <i><span style="color: #008000">// Error handling here</span></i>
}

<i><span style="color: #008000">// Event is received when</span></i>
<i><span style="color: #008000">// the buffer is processed.</span></i>

<strong><span style="color: #000080">void</span></strong> APP_WM8904BufferEventHandler(<a href="00224.html" target="topic">DRV_WM8904_BUFFER_EVENT</a> event,
        <a href="00229.html" target="topic">DRV_WM8904_BUFFER_HANDLE</a> bufferHandle, uintptr_t contextHandle)
{
    <i><span style="color: #008000">// contextHandle points to myAppObj.</span></i>

    <strong><span style="color: #000080">switch</span></strong>(event)
    {
        <strong><span style="color: #000080">case</span></strong> DRV_WM8904_BUFFER_EVENT_COMPLETE:

            <i><span style="color: #008000">// This means the data was transferred.</span></i>
            <strong><span style="color: #000080">break</span></strong>;

        <strong><span style="color: #000080">case</span></strong> DRV_WM8904_BUFFER_EVENT_ERROR:

            <i><span style="color: #008000">// Error handling here.</span></i>
            <strong><span style="color: #000080">break</span></strong>;

        <strong><span style="color: #000080">default</span></strong>:
            <strong><span style="color: #000080">break</span></strong>;
    }
}
</pre></div></div>
</div>
</div>
<a name="52656D61726B73"></a><div class="Element14">
Remarks</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
This function is thread safe in a RTOS application. It can be called from within the WM8904 Driver Buffer Event Handler that is registered by this client. It should not be called in the event handler associated with another WM8904 driver instance. It should not otherwise be called directly in an ISR.&nbsp;</p>
<p class="Element10">
This function is useful when there is valid read expected for every WM8904 write. The transmit and receive size must be same.</p></div>
</div>
<a name="43"></a><div class="Element99">
C</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #000080">void</span></strong> <strong><span style="color: #000000">DRV_WM8904_BufferAddWriteRead</span></strong>(
    <strong><span style="color: #000080">const</span></strong> DRV_HANDLE <strong><span style="color: #000000">handle</span></strong>, 
    <a href="00229.html" target="topic">DRV_WM8904_BUFFER_HANDLE</a> * <strong><span style="color: #000000">bufferHandle</span></strong>, 
    <strong><span style="color: #000080">void</span></strong> * <strong><span style="color: #000000">transmitBuffer</span></strong>, 
    <strong><span style="color: #000080">void</span></strong> * <strong><span style="color: #000000">receiveBuffer</span></strong>, 
    size_t <strong><span style="color: #000000">size</span></strong>
);</pre></div></div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00090.html" target="topic">Audio Driver Libraries Help</a> &gt; <a href="00355.html" target="topic">WM8904 CODEC Driver Library Help</a> &gt; <a href="00356.html" target="topic">Library Interface</a> &gt; Data Transfer Functions &gt; <a href="00233.html" target="topic">DRV_WM8904_BufferAddWriteRead Function</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element3">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00096.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element91">
<a href="00232.html" target="topic">Previous</a> | <a href="00356.html" target="topic">Up</a> | <a href="00275.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_WM8904_BufferAddWriteRead@DRV_HANDLE@DRV_WM8904_BUFFER_HANDLE *@void *@void *@size_t Topic Title: DRV_WM8904_BufferAddWriteRead Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>