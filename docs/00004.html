<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>audio_player_basic</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', '00004.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00018.html" target="topic">Audio Demonstrations</a> &gt; <a href="00016.html" target="topic">Demonstrations</a> &gt; <a href="00004.html" target="topic">audio_player_basic</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00042.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00016.html" target="topic">Previous</a> | <a href="00016.html" target="topic">Up</a> | <a href="00005.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO audio_player_basic Topic Title: audio_player_basic)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table><div class="Element5">
audio_player_basic</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The audio player (audio_player_basic) application configures the development board to be in USB Mass Storage Device (MSD) Host mode. The application supports the FAT file system. When a mass storage device is connected to the development board via its Target USB port, the device is mounted, and the application begins to scan for files starting at the root directory. It will search for .wav files up to 10 directory levels deep. A list of files found, and their paths, will be created and stored.&nbsp;</p>
<p class="Element10">
Once the scan is complete, the first track in the list will be opened, validated and played. The application will read the .wav file header to validate. Configuration of the number of channels, sample size, and sample rate stated in the file will be handled by the application for proper playback. If a file that can’t be played is found, it will be skipped, and the next sequential file will be tried. If the file can be played, it will then go on and read the .wav file data and write it to the codec for playback.&nbsp;</p>
<p class="Element10">
Command and control of the codec is done through an I2C driver. Data to the codec driver is sent through SSC via I2S Driver and the output will be audible through the headphone output jack of the WM8904 Audio Codec Module connected to the SAM E70 Xplained Ultra board.&nbsp;</p>
<p class="Element10">
Supported audio files are as represented in the table below. </p><p class="Element10" style="text-align: center;">
<strong>Supported Format</strong></p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element75" valign="top" width="20%">
<div class="Element76">
Audio Format&nbsp;</div></td><td class="Element75" valign="top" width="20%">
<div class="Element76">
Sample Rate (kHz)&nbsp;</div></td><td class="Element65" valign="top" width="60%">
<div class="Element66">
Description&nbsp;</div></td></tr><tr>
<td class="Element77" valign="top" width="20%">
<div class="Element78">
WAVE (.wav)&nbsp;</div></td><td class="Element77" valign="top" width="20%">
<div class="Element78">
8 to 96&nbsp;</div></td><td class="Element67" valign="top" width="60%">
<div class="Element68">
The WAVE file format is the native file format used by Microsoft Windows for storing digital audio data.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
The defines DISK_MAX_DIRS and DISK_MAX_FILES in the <span class="Element146">app.h</span> file, determines the maximum number of directories that should be scanned at each level of the directory tree (to prevent stack overflow, the traversing level is limited to 10), and the maximum number of songs in total the demonstration should scan (currently set to 4000 because of memory limitations).</p><div class="Element15">
Architecture</div>
<p class="Element10">
The application runs on the SAM E70 Xplained Ultra Board, which contains a ATSAME70Q21B microcontroller with 2 MB of Flash memory and 384 KB of RAM running at 300 MHz using the following features:</p>
<ul class="Element630">
<li class="Element600">One push button (SW1)</li>
<li class="Element600">Two LEDs (amber LED1 and green LED2)</li>
<li class="Element600">WM8904 Codec Daughter Board mounted on a X32 socket</li>
</ul><p class="Element10">
The SAM E70 Xplained Ultra board does not include the WM8904 Audio Codec daughterboard, which is sold separately on microchipDIRECT as part number AC328904.&nbsp;</p>
<p class="Element10">
The application currently only supports WAVE (.wav) format files.&nbsp;</p>
<p class="Element10">
The audio_player_basic application uses the MPLAB Harmony Configurator to setup the USB MSD Host, file system, codec, and other items in order to read the music files on a USB mass storage device and play it back through the WM8904 Codec Module. It scans WAV (PCM) format files from a mounted FAT USB thumb drive and streams audio through a WM8904 Audio Codec to a pair of headphones. In the application, the number of audio output buffers can always set to be more than two to enhance the audio quality. The size of input buffer in this application is be chosen to be able to handle the data supported.&nbsp;</p>
<p class="Element10">
The following figure shows the architecture for the demonstration. </p><p class="Element10" style="text-align: center;">
<strong>Architecture Block Diagram</strong>&nbsp;</p>
<p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic BlockDiagram.png" border="0" alt="" title="">&nbsp;</p><div class="Element15">
Demonstration Features</div>

<ul class="Element630">
<li class="Element600">USB MSD Host Client Driver (see USB MSD Host Client Driver Library)</li>
<li class="Element600">FAT File System (see File System Service Library)</li>
<li class="Element600">Audio real-time buffer handling</li>
<li class="Element600">WM8904 Codec Driver (see Audio Codec Driver Libraries)</li>
<li class="Element600">I<sup>2</sup>S usage in audio system (see I2S Driver Library)</li>
<li class="Element600">DMA (see DMA Peripheral Library)</li>
<li class="Element600">Timer (see Timer Peripheral Library)</li>
<li class="Element600">GPIO Control (see Port Peripheral Library)</li>
</ul><div class="Element15">
Tools Setup Differences</div>
<p class="Element10">
The project graph below specifies the drivers, services, and libraries being brought into the project to further extend the applications abilities. The default configuration should be correct for the majority of the application. The following configurations will need to be changed in order for proper operations. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_E70_project_graph.png" border="0" alt="" title=""></p><p class="Element10">
<u>MPLAB Harmony Configurator: <i>Tools&gt;Clock</i> Configuration</u>&nbsp;</p>
<p class="Element10">
Uncheck the Main RC Oscillator and check the “Bypass” for the Main Crystal Oscillator. When the Bypass is checked, it will cause the Main Crystal Oscillator to become unchecked. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_clock_config.png" border="0" alt="" title=""></p><p class="Element10">
Enable the PCK2 output to enable the WM8904 master clock: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_clock_config2.png" border="0" alt="" title=""></p><p class="Element10">
<i>Clock Diagram&gt;Peripheral Clock Enable</i>&nbsp;</p>
<p class="Element10">
Enable clocking for the SSC. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_clock_config3.png" border="0" alt="" title=""></p><p class="Element10">
<u>MPLAB Harmony Configurator: <i>File System</u></i>&nbsp;</p>
<p class="Element10">
The Auto Mount feature must be selected in order to expose the media type selection. The media type that is being used in this application is Mass Storage Device. This must be correctly configured, or the storage device will not mount. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_fs.png" border="0" alt="" title=""></p><p class="Element10">
<u>MPLAB Harmony Configurator: <i>Timer Driver (TC0)</u></i>&nbsp;</p>
<p class="Element10">
The Timer driver configuration, Timer driver instance 0, is used by a system. It needs to be set to “Enable Period Interrupt”. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_tc.png" border="0" alt="" title=""></p><p class="Element10">
<u>MPLAB Harmony Configurator: <i>System</u></i>&nbsp;</p>
<p class="Element10">
Set the heap size in Harmony if it is not already set for the linker. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO audio_player_basic_heap.png" border="0" alt="" title=""></p></div>
</div>
<a name="546F70696373"></a><div class="Element14">
Topics</div>
<div class="Element11">
<div class="Element10">
<div class="Element212">
<div class="TableDiv">
<table cellspacing="0" class="Table1">
<tr>
<td class="Element200" valign="top" width="35%">
<div class="Element201">
Name&nbsp;</div></td><td class="Element204" valign="top" width="65%">
<div class="Element205">
Description&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00005.html" target="topic">Building the Application</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section identifies the MPLAB X IDE project name and location and lists and describes the available configurations for the demonstration.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00006.html" target="topic">Configuring the Hardware</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section describes how to configure the supported hardware.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="00007.html" target="topic">Running the Demonstration</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section demonstrates how to run the demonstration.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00018.html" target="topic">Audio Demonstrations</a> &gt; <a href="00016.html" target="topic">Demonstrations</a> &gt; <a href="00004.html" target="topic">audio_player_basic</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element3">
MPLAB Harmony Audio Help</div>
</td><td width="25%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00042.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element91">
<a href="00016.html" target="topic">Previous</a> | <a href="00016.html" target="topic">Up</a> | <a href="00005.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO audio_player_basic Topic Title: audio_player_basic)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>